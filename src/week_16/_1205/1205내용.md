# [ 16ì£¼ì°¨ - 1205 ]

```bash
    ê¸ˆì¼ ì»¤ë¦¬í˜ëŸ¼
        â”œ 09:00 ~ 12:00 Devops (Kubernetes Volume)
        â”” 13:00 ~ 18:00 Devops (Kubernetes í”„ë¡ íŠ¸-ë°±ì—”ë“œ ì‹¤ìŠµ, ìŠ¤ì¼€ì¼ë§ê³¼ ë¡¤ë§ ì—…ë°ì´íŠ¸)
```

## 1. kubernetes - Volume

### 1.1 ë³¼ë¥¨ ì¢…ë¥˜

| ì¢…ë¥˜       | ì„¤ëª…                              | ì˜ˆì‹œ       |
| -------- | ------------------------------- | -------- |
| emptyDir | íŒŒë“œ ì•ˆì—ì„œë§Œ ê³µìœ  / íŒŒë“œ ì‚­ì œ ì‹œ ë°ì´í„° ì‚­ì œ     | ì„ì‹œ Cache |
| hostPath | ë…¸ë“œ Host OS íŒŒì¼ ì‹œìŠ¤í…œ ì‚¬ìš©            | ê°œë°œ í…ŒìŠ¤íŠ¸   |
| nfs      | ì™¸ë¶€ NFS ìŠ¤í† ë¦¬ì§€ ì—°ê²°                  | ì‚¬ë‚´ íŒŒì¼ì„œë²„  |
| **PVC**      | ì €ì¥ì†Œ ìš”ì²­(Persistent Volume Claim) | ë™ì  í• ë‹¹    |
| **PV**       | ìŠ¤í† ë¦¬ì§€ ìì²´(Persistent Volume)      | ê´€ë¦¬ì ì œê³µ   |

- podëŠ” ê¸°ë³¸ì ìœ¼ë¡œ íœ˜ë°œì„± ì €ì¥ì†Œë¥¼ ì‚¬ìš©í•˜ê²Œë¨ (ì¼ì‹œì ì„)
- volumeì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥í•˜ê±°ë‚˜ ì—¬ëŸ¬ íŒŒë“œ ê°„ì— ë°ì´í„°ë¥¼ ê³µìœ í•  ìˆ˜ ìˆìŒ
- volumeì€ íŒŒë“œì˜ ë¼ì´í”„ì‚¬ì´í´ê³¼ ë…ë¦½ì ìœ¼ë¡œ ì¡´ì¬í•  ìˆ˜ ìˆìŒ
- ë”°ë¼ì„œ podê°€ ì‚­ì œë˜ë”ë¼ë„ volumeì— ì €ì¥ëœ ë°ì´í„°ëŠ” ìœ ì§€ë  ìˆ˜ ìˆìŒ


### 1.2 PV ì˜ˆì œ

- pv-hostpath.yml
- ìŠ¤í† ë¦¬ì§€ í¬ê¸°ëŠ” 1Gi = 1024MB (Mi)
- ì‚­ì œì •ì±… : 
  - Retain : pvc ì‚­ì œì‹œ pvëŠ” ë‚¨ì•„ìˆìŒ
  - Recycle : ìë™ ì´ˆê¸°í™” í›„ ì¬ì‚¬ìš© (deprecated)
  - Delete : pvc ì‚­ì œì‹œ pvë„ ì‚­ì œ

```yml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: my-pv
spec:
  capacity:
    storage: 1Gi
  accessModes:
    - ReadWriteOnce
  hostPath:
    path: /tmp/data        # ë…¸ë“œì˜ ë¡œì»¬ ë””ë ‰í† ë¦¬ (í…ŒìŠ¤íŠ¸ìš©)
  persistentVolumeReclaimPolicy: Retain # ì‚­ì œ ì •ì±… : Retain, Recycle, Delete
```

- pv ìƒì„±ì‹œ

```bash
kubectl apply -f pv-hostpath.yml
```

- í•´ë‹¹ pv í™•ì¸

```bash
kubectl get pv
kubectl describe pv my-pv

# ì¶œë ¥ ì˜ˆì‹œ (ì¼ë¶€ ìƒëµ)
Name:            my-pv
Labels:          <none>
Annotations:     <none>
Finalizers:      [kubernetes.io/pv-protection]
StorageClass:
Status:          Available
Claim:
Reclaim Policy:  Retain
Access Modes:    RWO
Capacity:        1Gi
Node Affinity:   <none>
VolumeMode:      Filesystem
```


### 1.3 PVC ì˜ˆì œ

- deploy-volume.yml

```yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: volume-demo-deploy
spec:
  replicas: 1
  selector:
    matchLabels:
      app: volume-demo
  template: # íŒŒë“œ í…œí”Œë¦¿
    metadata:
      labels:
        app: volume-demo
    spec:
      containers:
      - name: nginx-container # ì»¨í…Œì´ë„ˆ ì´ë¦„
        image: nginx:alpine
        ports:
        - containerPort: 80 # ì»¨í…Œì´ë„ˆ í¬íŠ¸
        volumeMounts:
        - name: my-data-volume
          mountPath: /data         # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ê²½ë¡œ
      volumes:
      - name: my-data-volume
        persistentVolumeClaim:
          claimName: my-pvc        # PVC ì´ë¦„
```

- ë””í”Œë¡œì´ë¨¼íŠ¸ pvc ìƒì„±ì‹œ

```bash
kubectl apply -f deploy-volume.yml
```

- pvcë¡œ ì„ ì–¸í•œ pod í™•ì¸

```bash
kubectl get pods

# ì¶œë ¥ ì˜ˆì‹œ
NAME                                 READY   STATUS    RESTARTS   AGE
volume-demo-deploy-5d6f7c9f7b-abcde   1/1     Running   0          2m
```

### 1.4 ë™ì‘ ìƒíƒœ í™•ì¸

- pvc ë¡œ ì„ ì–¸í•œ pod ì ‘ì†

```bash
# í•´ë‹¹ í¬ë“œ ë‚´ ì ‘ì†
kubectl exec -it <podì´ë¦„> -- /bin/sh

# /data ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd /data

# ë°ì´í„° ìƒì„±
echo "Hello Kubernetes Volume" > testfile.txt

# ë””ë ‰í† ë¦¬, ê¶Œí•œ í™•ì¸
ls -l /data
```

### 1.5 pvcì™€ ì—°ê²°ëœ pv í™•ì¸

```bash
kubectl get pvc

# ì¶œë ¥ ì˜ˆì‹œ
NAME      STATUS   VOLUME   CAPACITY   ACCESSMODES   AGE
my-pvc    Bound    my-pv    1Gi        RWO           30s
```

| STATUS   | ì˜ë¯¸                      |
| -------- | ----------------------- |
| Pending  | PVê°€ ì—†ì–´ì„œ ë°”ì¸ë”© ëª»í•œ ìƒíƒœ       |
| Bound    | PVì™€ ì •ìƒ ì—°ê²°ëœ ìƒíƒœ           |
| Released | PVCëŠ” ì‚­ì œë˜ì—ˆì§€ë§Œ PVëŠ” ë‚¨ì•„ìˆëŠ” ìƒíƒœ |
| Failed   | ë°”ì¸ë”© ì‹¤íŒ¨                  |

### 1.6 pod ì‚­ì œ í›„ ë°ì´í„° í™•ì¸

- í˜„ì¬ pvcê°€ ë°”ì¸ë”©ë˜ì–´ ìˆëŠ” ê²½ìš°, pod ì‚­ì œí•´ë„ ë°ì´í„°ëŠ” ìœ ì§€ë¨
- ì‚­ì œ í›„ í™•ì¸í•´ë³´ê¸°

```bash
kubectl delete pod <pod-name>

kubectl get pods   # ìƒˆ íŒŒë“œ ìë™ ìƒì„± í™•ì¸

# ìƒˆë¡œ ìƒì„±ëœ íŒŒë“œ ì ‘ì†
# testfile.txt ê°€ ê·¸ëŒ€ë¡œ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
kubectl exec -it <new-pod> -- /bin/sh
cd /data
ls -l
```

### 1.7 hostPath ì‹¤ì œ íŒŒì¼ í™•ì¸ 

- docker-desktop í™˜ê²½ì—ì„œ k8s ë…¸ë“œ íŒŒì¼ì‹œìŠ¤í…œ ì ‘ê·¼

```bash
# wslì—ì„œ docker-desktop ë…¸ë“œíŒŒì¼ì‹œìŠ¤í…œ ì ‘ì†
wsl -d docker-desktop

# pvc í™•ì¸
ls /tmp/docker-desktop-root/var/lib/k8s-pvs
# ì¶œë ¥ì˜ˆì‹œ : my-pvc

# pv ë°ì´í„° í™•ì¸
cd /tmp/docker-desktop-root/var/lib/k8s-pvs
ls

# testfile.txt íŒŒì¼ í™•ì¸
```

### 1.8 ìš”ì•½ ì •ë¦¬

- **PV**(PersistentVolume): ìŠ¤í† ë¦¬ì§€ ìì²´ (ê´€ë¦¬ìê°€ ë¯¸ë¦¬ ì œê³µ)
- **PVC**(PersistentVolumeClaim): ìŠ¤í† ë¦¬ì§€ ìš”ì²­ (íŒŒë“œ/ì‚¬ìš©ìê°€ ìš”ì²­)
- ë‘˜ì´ ë§¤ì¹­ë˜ë©´ Bound ìƒíƒœê°€ ë˜ë©° ìŠ¤í† ë¦¬ì§€ë¥¼ ì‚¬ìš© ê°€ëŠ¥

```bash
PV ìƒì„±  â†’  PVC ìƒì„±  â†’  PVCê°€ PVë¥¼ ìš”ì²­  â†’  ë°”ì¸ë”©(Bound)
â†’ Deploymentì—ì„œ pvc ì‚¬ìš© (volumeMount)
/data ì— íŒŒì¼ ì“°ë©´ PVì— ì €ì¥ë¨
```

**hostPath ì‚¬ìš© ì‹œ**

- í…ŒìŠ¤íŠ¸ìš©ì„
- ì‹¤ì œ ìœ„ì¹˜ëŠ” k8s ë…¸ë“œ íŒŒì¼ì‹œìŠ¤í…œ
- Docker Desktop í™˜ê²½ì—ì„œëŠ” WSL(docker-desktop) ì— ì €ì¥ë¨

**pod ì‚­ì œ ì‹œ**

- PVCê°€ ê³„ì† ì¡´ì¬í•˜ë©´ PVë„ ìœ ì§€ë¨
- ìƒˆ íŒŒë“œê°€ ìë™ ìƒì„±ë˜ì–´ë„ ë°ì´í„° ì‚¬ìš© ê°€ëŠ¥

**ì‚­ì œì •ì±…**

- persistentVolumeReclaimPolicy
  - Retain : pvc ì‚­ì œì‹œ pvëŠ” ë‚¨ì•„ìˆìŒ
  - Recycle : ìë™ ì´ˆê¸°í™” í›„ ì¬ì‚¬ìš©
  - Delete : pvc ì‚­ì œì‹œ pvë„ ì‚­ì œ

---


## 2. ê°„ë‹¨í•œ Kubernetes í”„ë¡ íŠ¸-ë°±ì—”ë“œ ì‹¤ìŠµ

### 2.1 frontend ê´€ë ¨ ì‘ì„±

#### ë””ë ‰í† ë¦¬ êµ¬ì¡°

```bash
my-web-app
  â”œâ”€â”€ assets/
  â”‚   â”œâ”€â”€ js/script.js
  â”‚   â””â”€â”€ css/style.css
  â”‚
  â”œâ”€â”€ Dockerfile
  â””â”€â”€ index.html

```


<details>
<summary><strong>index.html ì†ŒìŠ¤ë³´ê¸°</strong></summary>

- ê²½ë¡œ : my-web-app/index.html

```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kubernetes ì‹¤ìŠµ</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Hello Kubernetes!</h1>
        <p>ì•ˆë…•í•˜ì„¸ìš”! Kubernetesì— ë°°í¬ëœ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤.</p>
        <div class="info">
            <p><strong>Pod ì´ë¦„:</strong> <span id="hostname">Loading...</span></p>
            <p><strong>í˜„ì¬ ì‹œê°„:</strong> <span id="time"></span></p>
        </div>
        <button onclick="updateTime()">ì‹œê°„ ì—…ë°ì´íŠ¸</button>

        <div class="api-section">
            <h2>ğŸ”— ë°±ì—”ë“œ API ì—°ë™</h2>
            <p id="api-status">ì—°ê²° ì¤‘...</p>
            <p><strong>API ì‘ë‹µ:</strong> <span id="api-response">Loading...</span></p>
            <button onclick="callBackendAPI()">API ì¬í˜¸ì¶œ</button>
        </div>
    </div>
    <script src="assets/js/script.js"></script>
</body>
</html>
```

</details>


<details>
<summary><strong>style.css ì†ŒìŠ¤ë³´ê¸°</strong></summary>

- ê²½ë¡œ : my-web-app/assets/css/style.css

```css
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

.container {
    background: white;
    padding: 40px;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    text-align: center;
    max-width: 500px;
}

h1 {
    color: #333;
    margin-bottom: 20px;
}

p {
    color: #666;
    margin-bottom: 15px;
    font-size: 16px;
}

.info {
    background: #f5f5f5;
    padding: 20px;
    border-radius: 5px;
    margin: 20px 0;
}

.info p {
    margin: 10px 0;
}

button {
    background: #667eea;
    color: white;
    border: none;
    padding: 12px 30px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    transition: background 0.3s;
    margin: 5px;
}

button:hover {
    background: #5568d3;
}

.api-section {
    background: #e8f4f8;
    padding: 20px;
    border-radius: 5px;
    margin-top: 20px;
    border-left: 4px solid #667eea;
}

.api-section h2 {
    color: #333;
    font-size: 18px;
    margin-bottom: 15px;
}

#api-status {
    font-weight: bold;
    margin: 10px 0;
}
```

</details>



<details>
<summary><strong>script.js ì†ŒìŠ¤ë³´ê¸°</strong></summary>

- ê²½ë¡œ : my-web-app/assets/js/script.js

```js
// ë°±ì—”ë“œ API URL (ê¸°ë³¸ê°’: ë¡œì»¬í˜¸ìŠ¤íŠ¸, Kubernetes í™˜ê²½ì—ì„œëŠ” Service ì´ë¦„ ì‚¬ìš©)
const API_URL = window.API_URL || 'http://localhost:8080';

// í˜„ì¬ ì‹œê°„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updateTime() {
    const now = new Date();
    // í•œêµ­ ì‹œê°„ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
    const timeString = now.toLocaleString('ko-KR', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    });
    document.getElementById('time').textContent = timeString;
}

// ë°±ì—”ë“œ API í˜¸ì¶œ í•¨ìˆ˜
async function callBackendAPI() {
    try {
        // API í˜¸ì¶œ (/hello ì—”ë“œí¬ì¸íŠ¸)
        const response = await fetch(`${API_URL}/hello`);
        const message = await response.text();
        document.getElementById('api-response').textContent = message;
        document.getElementById('api-status').textContent = 'âœ… ì—°ê²° ì„±ê³µ';
        document.getElementById('api-status').style.color = 'green';
    } catch (error) {
        document.getElementById('api-response').textContent = 'ì—°ê²° ì‹¤íŒ¨';
        document.getElementById('api-status').textContent = 'âŒ ë°±ì—”ë“œ ì—°ê²° ì‹¤íŒ¨';
        document.getElementById('api-status').style.color = 'red';
        console.error('API í˜¸ì¶œ ì‹¤íŒ¨:', error);
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
window.onload = function() {
    // ì‹œê°„ ì—…ë°ì´íŠ¸
    updateTime();
    setInterval(updateTime, 1000);

    // í˜¸ìŠ¤íŠ¸ëª… í‘œì‹œ
    document.getElementById('hostname').textContent = 'web-app-pod-' + Math.random().toString(36).substr(2, 9);

    // ë°±ì—”ë“œ API í˜¸ì¶œ
    callBackendAPI();
};
```

</details>



<details>
<summary><strong>style.css ì†ŒìŠ¤ë³´ê¸°</strong></summary>

- ê²½ë¡œ : my-web-app/assets/css/style.css

```css
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

.container {
    background: white;
    padding: 40px;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    text-align: center;
    max-width: 500px;
}

h1 {
    color: #333;
    margin-bottom: 20px;
}

p {
    color: #666;
    margin-bottom: 15px;
    font-size: 16px;
}

.info {
    background: #f5f5f5;
    padding: 20px;
    border-radius: 5px;
    margin: 20px 0;
}

.info p {
    margin: 10px 0;
}

button {
    background: #667eea;
    color: white;
    border: none;
    padding: 12px 30px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    transition: background 0.3s;
    margin: 5px;
}

button:hover {
    background: #5568d3;
}

.api-section {
    background: #e8f4f8;
    padding: 20px;
    border-radius: 5px;
    margin-top: 20px;
    border-left: 4px solid #667eea;
}

.api-section h2 {
    color: #333;
    font-size: 18px;
    margin-bottom: 15px;
}

#api-status {
    font-weight: bold;
    margin: 10px 0;
}
```

</details>



<details>
<summary><strong>Dockerfile ì†ŒìŠ¤ë³´ê¸°</strong></summary>

- ê²½ë¡œ : my-web-app/Dockerfile

```bash
# Nginx ê²½ëŸ‰ ì´ë¯¸ì§€ ì‚¬ìš©
FROM nginx:alpine

# ì‘ì„±í•œ HTML, CSS, JS íŒŒì¼ì„ Nginxì˜ ì›¹ ë£¨íŠ¸ë¡œ ë³µì‚¬
COPY index.html /usr/share/nginx/html/
# COPY style.css /usr/share/nginx/html/
# COPY script.js /usr/share/nginx/html/

COPY assets /usr/share/nginx/html/assets

# Nginx í¬íŠ¸
EXPOSE 80

# ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì‹œ Nginx ì‹¤í–‰
CMD ["nginx", "-g", "daemon off;"]
```

</details>


#### í”„ë¡ íŠ¸ ê´€ë ¨ Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° ì‹¤í–‰

- ì´ë¯¸ì§€ ë¹Œë“œ

```bash
docker build -t my-web-app:1.0 .
```

- ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```bash
docker run -d -p 80:80 --name my-web-container my-web-app:1.0
```

- ë¸Œë¼ìš°ì € ì ‘ì† : `http://localhost`


### 2.2 backend ê´€ë ¨ ì‘ì„±

> jdk 21, spring boot 4.0.0

#### ë””ë ‰í† ë¦¬ êµ¬ì¡°

```bash
my-spring-boot-app
  â”œâ”€â”€ build/ ...
  â”œâ”€â”€ src/main/java/org/example/myspringbootapp/
  â”‚   â”œâ”€â”€ Application.java
  â”‚   â””â”€â”€ ExamController.java
  â”‚
  â”œâ”€â”€ build.gradle
  â””â”€â”€ Dockerfile
```

#### build.gradle ì˜ì¡´ì„±

- ì˜ì¡´ì„± Spring Web MVC ì¶”ê°€

```groovy
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-webmvc'
    testImplementation 'org.springframework.boot:spring-boot-starter-webmvc-test'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}
```

#### ì†ŒìŠ¤ì‘ì„±

<details>
<summary><strong>Application.java ì†ŒìŠ¤ë³´ê¸°</strong></summary>

```java
package org.example.myspringbootapp;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class MySpringBootAppApplication {

    public static void main(String[] args) {
        SpringApplication.run(MySpringBootAppApplication.class, args);
    }

}
```

</details>

<details>
<summary><strong>ExamController.java ì†ŒìŠ¤ë³´ê¸°</strong></summary>

```java
package org.example.myspringbootapp.controller;

import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@CrossOrigin(origins = "*") // f-endì—ì„œ api í˜¸ì¶œ CORS
@RestController
public class ExamController {
    @GetMapping("/hello") // í”„ë¡ íŠ¸ì—ì„œ ë°›ëŠ” ìš”ì²­ ê²½ë¡œ
    public String hello() {
        return "Hello k8s";
    }

}
```

</details>


<details>
<summary><strong>Dockerfile ì†ŒìŠ¤ë³´ê¸°</strong></summary>

```bash
# Java 21 í™˜ê²½ì˜ ê¸°ë³¸ ì´ë¯¸ì§€ ì‚¬ìš©
FROM eclipse-temurin:21-jdk

# ë¹Œë“œëœ JAR íŒŒì¼ ê²½ë¡œ
ARG JAR_FILE=build/libs/my-spring-boot-app-0.0.1-SNAPSHOT.jar

# ìµœì¢…ì ìœ¼ë¡œ í•´ë‹¹ jarë¥¼ app.jarë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë³µì‚¬
COPY ${JAR_FILE} app.jar

# ì»¨í…Œì´ë„ˆ 8080 í¬íŠ¸ ì˜¤í”ˆ (Spring Boot ê¸°ë³¸)
EXPOSE 8080

# ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ë  ë•Œ Spring Boot JAR ì‹¤í–‰
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

</details>

#### ë°±ì—”ë“œ Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° ì‹¤í–‰

- ìŠ¤í”„ë§ ìš°ì„  ë¹Œë“œ

```bash
./gradlew build -x test
```

- ì´ë¯¸ì§€ ë¹Œë“œ

```bash
docker build -t my-spring-boot-app .
```

- ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```bash
docker run -d -p 8080:8080 --name my-spring-boot-container my-spring-boot-app:1.0
```

### 2.3 í”„ë¡ íŠ¸-ë°±ì—”ë“œ ì—°ë™ í…ŒìŠ¤íŠ¸ í™•ì¸

dockerì—ì„œ ê° ì»¨í…Œì´ë„ˆê°€ ëª¨ë‘ ì‹¤í–‰ëœ ìƒíƒœì—ì„œ ë¸Œë¼ìš°ì €ë¡œ ì ‘ì†

- `http://localhost`

![alt text](image.png)

---

## 3. ìŠ¤ì¼€ì¼ë§ê³¼ ë¡¤ë§ ì—…ë°ì´íŠ¸

> ì‹¤í–‰ ì¤‘ì¸ Pod ê°œìˆ˜ë¥¼ ëŠ˜ë¦¬ê±°ë‚˜ ì¤„ì—¬ì„œ íŠ¸ë˜í”½ ë¶€í•˜ì— ëŒ€ì‘í•˜ëŠ” ê¸°ëŠ¥

- **ìˆ˜í‰í™•ì¥**
  - Podì˜ ê°œìˆ˜ë¥¼ ëŠ˜ë¦¬ê±°ë‚˜ ì¤„ì´ëŠ” ë°©ì‹
  - ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ê¸°ë³¸ ìŠ¤ì¼€ì¼

- **ìˆ˜ì§í™•ì¥**
  - Podì˜ ë¦¬ì†ŒìŠ¤(CPU, ë©”ëª¨ë¦¬ ë“±)ë¥¼ ëŠ˜ë¦¬ê±°ë‚˜ ì¤„ì´ëŠ” ë°©ì‹
  - ì¼ë°˜ì ìœ¼ë¡œ ê¶Œì¥ë˜ì§€ ì•ŠìŒ (ì¬ì‹œì‘ í•„ìš”)


### 3.1 ì˜ˆì‹œìš© ë””í”Œë¡œì´ë¨¼íŠ¸ ì‘ì„±

- exam-deployment.yml

```yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: exam-deployment
spec:
  replicas: 2               # ê¸°ë³¸ pod 2ê°œ
  selector:
    matchLabels:
      app: nginx-app
  template:
    metadata:
      labels:
        app: nginx-app
    spec:
      containers:
      - name: nginx-container
        image: nginx:alpine      # ê¸°ë³¸ ë²„ì „
        ports:
        - containerPort: 80
```

```bash
# ë°°í¬
kubectl apply -f exam-deployment.yml

# ë°°í¬ í™•ì¸
kubectl get deployments
kubectl get pods
```


### 3.2 ìˆ˜ë™ ìŠ¤ì¼€ì¼ë§ ë°©ì‹

- pod ìˆ˜ ëŠ˜ë¦¬ê±°ë‚˜ ì¤„ì´ê¸°

```bash
# ìˆ˜ë™ ìŠ¤ì¼€ì¼ë§ (pod ìˆ˜ 5ê°œë¡œ ë³€ê²½)
kubectl scale deployment exam-deployment --replicas=5

# ìƒíƒœ í™•ì¸ (labelë¡œ í•„í„°ë§)
kubectl get pods -l app=nginx-app
```

### 3.3 ìë™ ìŠ¤ì¼€ì¼ë§ ë°©ì‹ (HPA) - ë¹„ê¶Œì¥

- CPU ì‚¬ìš©ëŸ‰ ê¸°ì¤€ìœ¼ë¡œ ìë™ ìŠ¤ì¼€ì¼ë§ ì„¤ì •

```bash
# ìë™ ìŠ¤ì¼€ì¼ë§ ì„¤ì • (ìµœì†Œ 2ê°œ, ìµœëŒ€ 10ê°œ, CPU ì‚¬ìš©ëŸ‰ 50% ê¸°ì¤€)
kubectl autoscale deployment exam-deployment --min=2 --max=10 --cpu-percent=50

# hpa ë¦¬ì†ŒìŠ¤ ìƒíƒœ í™•ì¸
kubectl get hpa

# í•´ë‹¹ hpa ì‚­ì œ
kubectl delete hpa exam-deployment
# ì›ë˜ëŒ€ë¡œ ë³µêµ¬
kubectl scale deploy exam-deployment --replicas=2
```


### 3.4 ë¡¤ë§ ì—…ë°ì´íŠ¸

> ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ì—†ì´ ìƒˆ ë²„ì „ì„ ë°°í¬

- ì´ë¯¸ì§€ ë²„ì „ ì—…ë°ì´íŠ¸ì‹œ

```bash
# ì´ë¯¸ì§€ ë²„ì „ ì—…ë°ì´íŠ¸ (nginx:1.24-alpine ìœ¼ë¡œ ë³€ê²½)
kubectl set image deployment/exam-deployment nginx-container=nginx:1.24-alpine
# kubectl set image deployment/web-deployment web-container=my-web-app:2.0

# ë¡¤ì•„ì›ƒ ìƒíƒœ í™•ì¸ (ë°°í¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§)
kubectl rollout status deployment web-deployment

# ì‹¤ì‹œê°„ pod ìƒíƒœ í™•ì¸ (-w : watch ëª¨ë“œ)
kubectl get pods -w -l app=nginx-app
```

- ë¡¤ë°± (ì´ì „ ë²„ì „ìœ¼ë¡œ ë³µêµ¬)

```bash
# í•´ë‹¹ ë””í”Œë¡œì´ë¨¼íŠ¸ì˜ ë²„ì „ íˆìŠ¤í† ë¦¬ í™•ì¸
kubectl rollout history deployment exam-deployment

# ì´ì „ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±
# ë°”ë¡œ ì´ì „ ë²„ì „
kubectl rollout undo deployment exam-deployment
# ë¦¬ë¹„ì „ ë°©ì‹ (íŠ¹ì • ë²„ì „ìœ¼ë¡œ ë³µêµ¬)
kubectl rollout undo deployment exam-deployment --to-revision=1

# ë¡¤ì•„ì›ƒ ìƒíƒœ í™•ì¸
kubectl rollout status deployment exam-deployment
```
