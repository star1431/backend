# [ 9주차 - 1014 ] 스터디 내용

```bash
    금일 커리큘럼
        ├ 09:00 ~ 14:00 backend 프로그래밍 (SpringBootApplication, PropertySource, Profile)
        └ 14:00 ~ 18:00 backend 프로그래밍 
```

## 1. @SpringBootApplication 이해

> 스프링 부트 애플리케이션의 **시작점**을 나타내는 어노테이션

* `@SpringBootApplication`은 스프링 부트 애플리케이션의 **시작점**을 나타내는 어노테이션
* 이 어노테이션은 다음 세 가지 어노테이션을 포함되어 있음
  * @Configuration
  * @EnableAutoConfiguration
  * @ComponentScan


### CommandLineRunner

* `CommandLineRunner` 인터페이스를 구현하여 애플리케이션 시작 후 실행할 코드를 작성할 수 있음
* `run` 메서드를 오버라이드하여 원하는 로직을 작성하면, 애플리케이션이 시작된 후 자동으로 실행됨

### 코드 예시

```java
package org.example.iocexam;

// import ...

// = @Configuration + @EnableAutoConfiguration + @ComponentScan
@SpringBootApplication 
public class IocexamApplication implements CommandLineRunner {
    // CommandLineRunner 인터페이스를 구현하여 애플리케이션 시작 후 실행할 코드 작성 가능

    public static void main(String[] args) {
        SpringApplication.run(IocexamApplication.class, args);
        // SpringApplication.run() 메서드는 스프링 부트 애플리케이션을 시작하는 역할
    }

    @Autowired
    UserController userController; // 예시임 - 비권장

    // 애플리케이션 시작 후 실행될 코드
    @Override
    public void run(String... args) throws Exception {
        userController.joinUser();
    }

}
```

### 람다식 예시

```java
package org.example.iocexam;

// import ...

@SpringBootApplication
public class IocexamApplication {

    public static void main(String[] args) {
        SpringApplication.run(IocexamApplication.class, args);
    }

    // 애플리케이션 시작 후 실행될 코드
    @Bean // 스프링 IoC 컨테이너에 빈(Bean)으로 등록
    public CommandLineRunner commandLineRunner(UserController userController) {
        // run 람다
        return args -> {
            userController.joinUser();
        };
    }

}
```

### 어떻게 패키지 범위가 정해지나?


* 스캔 시작 기준: IocexamApplication 클래스가 속한 패키지를 기준으로 하기 때문
* 즉, `org.example.iocexam` 패키지를 기준으로 하위 패키지들(`controller`, `service`, `repository`)까지 스캔됨

<br>

**패키지 범위를 바꿀려면 ?**

```java
@SpringBootApplication(scanBasePackages = {
  "org.example.iocexam", 
  "org.example.common"
})
public class IocexamApplication { ... }

// 또는

@SpringBootApplication
@ComponentScan(basePackages = {"org.example.iocexam", "org.example.common"})
public class IocexamApplication { ... }
```

---

## 3. @PropertySource 이해

> 외부 프로퍼티 파일을 스프링 환경에 통합하는 데 사용

* `@PropertySource` 어노테이션을 사용하여 외부 프로퍼티 파일을 스프링 환경에 통합할 수 있음
* 예를 들어, `game.properties` 파일을 스프링 환경에 통합하고, 해당 파일의 프로퍼티 값을 빈(Bean) 설정에 주입할 수 있음

### 코드 예시

```java
package sample.config;

// import ...

@Configuration
@PropertySource("classpath:game.properties") // game.properties 파일을 스프링 환경에 통합
public class GameConfig {
    // ...
    @Value("${face}") // 프로퍼티 설정값 주입
    int face;
}
```

```bash
# game.properties 파일 예시
face=45
```

---

## 2. @Profile 이해

> 특정 환경에 따라 빈(Bean) 등록을 다르게 할 때 사용

* `@Profile` 어노테이션은 특정 환경에 따라 빈(Bean) 등록을 다르게 할 때 사용
* 예를 들어, 개발 환경과 운영 환경에서 서로 다른 빈을 등록하고 싶을 때 유용함

### @Profile("prod") 예시

```java
package sample.config;

// import ...

@Configuration
@Profile("prod")
@PropertySource({"classpath:game.properties"})
public class GameConfig {

    @Bean
    public Dice dice(@Value("${face}") int face) {
        return new Dice();
    }

    @Bean
    public Player player1(Dice dice) {
        Player player = new Player(dice);
        player.setName("player1");
        return player;
    }

    @Bean
    public Game game(List<Player> players) {
        return new Game(players);
    }
}
```

### @Profile("dev") 예시

```java
package sample.config;

// import ...

@Configuration
@Profile("dev")
@PropertySource({"classpath:game.properties"})
public class GameDevConfig {

    @Value("45")
    int face;

    @Bean
    public Dice dice(/*@Value("${face}") int face*/){
        return new Dice(face);
    }

    @Bean
    public Player player1(Dice dice){
        // Player player = new Player(dice);
        Player player = new Player();
        player.setDice(dice);
        player.setName("신짱구");
        return player;
    }

    @Bean
    public Game game(List<Player> players){
        return  new Game(players);
    }

}
```

### 실행시 Profile 적용 방법

**1. 리소스폴더에 있는 application.properties 파일에 설정**

```bash
# 활성 프로파일 설정
spring.profiles.active=dev 
# or prod
```

> 리소스 폴더에서 환경별 설정 필요한 경우

* **application-{profile}.properties** 형식으로 파일 생성하면 자동으로 인식됨
    - 예 : dev, prod
    - application-dev.properties 파일생성
    - application-prod.properties 파일생성

* 환경파일 만들었다고 해서 바로 적용되는 건 아님!
    - **application.properties** 파일에서 어떤 환경을 활성화할지 지정 필요

```bash
src/main/resource
 ├ application.properties       # 공통 설정 (여기서 dev,prod 선택)
 ├ application-dev.properties   # dev 환경 별도 설정
 └ application-prod.properties  # prod 환경 별도 설정
```

```bash
# application-dev.properties 파일에서...
server.port=8080
logging.level.root=DEBUG

# application-prod.properties 파일에서...
server.port=80
logging.level.root=ERROR
```


**2. 터미널에서 설정**

```bash
# 개발 환경으로 실행
java -jar app.jar --spring.profiles.active=dev

# 운영 환경으로 실행
java -jar app.jar --spring.profiles.active=prod
``` 

**3. 인텔리제이 실행 구성 편집**

* Main 클래스 run 마우스 오른쪽 클릭 -> Edit Configurations... 선택
* profiles 항목에 `dev` 또는 `prod` 입력

![1015_profile](../../../assets/img/1015_profile.png)

---

